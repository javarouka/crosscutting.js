/*
 crosscutting. AOP JavaScript Library
 author: javarouka@gmail.com
 document: http://javarouka.github.io/crosscutting.js
 license: MIT
 create date: 2014-03-13
*/
!function(a){"function"==typeof define&&define.amd?define(a):"object"==typeof exports?module.exports=a():window.crosscutting=a()}(function(){"use strict";for(var a=[].slice,b={}.toString,c=new Error("argument is invalid"),d=new TypeError("cannot apply aop on Built-in Type"),e=new Error("advice function is invalid. It should be function type"),f={},g=["Function","Number","String","Date","RegExp","Boolean"],h=function(a){f["is"+a]=function(c){return b.call(c)==="[object "+a+"]"}},i=0,j=g.length;j>i;i++)h(g[i]);f.isArray=Array.isArray||function(a){return"[object Array]"===b.call(a)},f.isObject=function(a){return a===Object(a)};var k=[Function.prototype,Number.prototype,String.prototype,Date.prototype,Boolean.prototype,Object.prototype,Date.prototype,Array.prototype],l=k.length,m=function(b){return a.call(b)};f.argumentsToArray=m;var n={BEFORE:function(a){var b=a.advice.call(a.target,a),c=a.todo.apply(a.target,m(a.args));return b||c},AFTER:function(a){var b=a.todo.apply(a.target,m(a.args)),c=a.advice.call(a.target,a);return c||b},AROUND:function(a){return a.advice.call(a.target,function(){return a.todo.apply(a.target,m(arguments[0]?arguments:a.args))},a)},EXCEPTION:function(a){try{return a.todo.apply(a.target,m(a.args))}catch(b){return a.exception=b,a.advice.call(a.target,a)}}},o=function(a){this.matcher=a};o.prototype.isMatch=function(a){if(f.isBoolean(this.matcher))return this.matcher;if(f.isRegExp(this.matcher))return this.matcher.test(a);if(f.isFunction(this.matcher))return this.matcher(a);throw c};var p=function(a){return a.$crosscutting={wrap:!0},a},q=function(a,b,c,d,e){var f=function(){return c({args:arguments,target:a,todo:b,advice:d,type:c,method:e})};return f.methodName=e,f},r=function(a,b,c,e){var g,h,i,j;for(f.isArray(a)||(a=[a]),g=0,i=a.length;i>g;g++){for(j=a[g],h=0;l>h;h++)if(k[h]===j)throw d;f.isString(c)&&(c=n[c.toUpperCase()]);var m;for(var o in j)if(m=o,f.isString(m)){var p=j[m];f.isFunction(p)&&b.isMatch(m)&&(j[m]=q(j,p,c,e,m))}}return this};return f.Aspect={Pointcut:o,Advice:p,weave:r,AdviceType:n},f.before=function(a,b,c){return f.weave(a,b,n.BEFORE,c),this},f.after=function(a,b,c){return f.weave(a,b,n.AFTER,c),this},f.around=function(a,b,c){return f.weave(a,b,n.AROUND,c),this},f.exception=function(a,b,c){return f.weave(a,b,n.EXCEPTION,c),this},r(f.Aspect,new o(/^weave$/),f.Aspect.AdviceType.BEFORE,function(a){if(!a.args||a.args.length<3)throw c;if(!f.isObject(a.args[0]))throw c;if(!f.isFunction(a.advice))throw e;a.advice.$crosscutting||(a.advice=new p(a.advice)),a.args[1]instanceof o||(a.args[1]=new o(a.args[1]))}),f.weave=f.Aspect.weave,f});