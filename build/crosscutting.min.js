/*
 crosscutting. AOP JavaScript Library
 author: javarouka@gmail.com
 document: http://javarouka.github.io/crosscutting.js
 license: MIT
 create date: 2013-09-04
*/
!function(a){"use strict";var b=[].slice,c={}.hasOwnProperty,d={}.toString,e=new Error("argument is invalid"),f=new TypeError("cannot apply aop on Built-in Type"),g=new Error("advice function is invalid. It should be function type");Object.getPrototypeOf=Object.getPrototypeOf||function(a){return a.constructor?a.constructor.prototype:{}},Object.freeze=Object.freeze||function(a){return a},Object.create=Object.create||function(a){var b=function(){};return b.prototype=a,new b},Array.prototype.forEach=Array.prototype.forEach||function(a,b){var e,f;if(null==this)throw new TypeError("this is null or not defined");var g=Object(this),h=g.length>>>0;if("[object Function]"!==d.call(a))throw new TypeError(a+" is not a function");for(b&&(e=b),f=0;h>f;){var i;c.call(g,f)&&(i=g[f],a.call(e,i,f,g)),f++}};var h=a,i=Object.create(null),j=h.crosscutting;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=i),exports.crosscutting=i):h.crosscutting=i;for(var k=["Function","Number","String","Date","RegExp","Boolean"],l=function(a){i["is"+a]=function(b){return d.call(b)==="[object "+a+"]"}},m=0,n=k.length;n>m;m++)l(k[m]);i.isArray=Array.isArray||function(a){return"[object Array]"===d.call(a)},i.isObject=function(a){return a===Object(a)};var o=[Function.prototype,Number.prototype,String.prototype,Date.prototype,Boolean.prototype,Object.prototype,Date.prototype,Array.prototype];i.noConflict=function(){return h.crosscutting=j,this};var p=function(a){return b.call(a)};i.argumentsToArray=p;var q={BEFORE:function(a){var b=a.advice.call(a.target,a),c=a.todo.apply(a.target,p(a.args));return b||c},AFTER:function(a){var b=a.todo.apply(a.target,p(a.args)),c=a.advice.call(a.target,a);return c||b},AROUND:function(a){return a.advice.call(a.target,function(){return a.todo.apply(a.target,p(arguments[0]?arguments:a.args))},a)},EXCEPTION:function(a){try{return a.todo.apply(a.target,p(a.args))}catch(b){return a.exception=b,a.advice.call(a.target,a)}}},r=function(a){this.matcher=a};r.prototype.isMatch=function(a){if(i.isBoolean(this.matcher))return this.matcher;if(i.isRegExp(this.matcher))return this.matcher.test(a);if(i.isFunction(this.matcher))return this.matcher(a);throw e};var s=function(a){return a.$crosscutting={wrap:!0},a},t=function(a,b,c,d,e){var f=function(){return c({args:arguments,target:a,todo:b,advice:d,type:c,method:e})};return f.name=e,f},u=function(a,b,c,d){return i.isArray(a)||(a=[a]),a.forEach(function(a){o.forEach(function(b){if(b===a)throw f}),i.isString(c)&&(c=q[c.toUpperCase()]);var e;for(var g in a)if(e=g,i.isString(e)){var h=a[e];i.isFunction(h)&&b.isMatch(e)&&(a[e]=t(a,h,c,d,e))}}),this};i.Aspect={Pointcut:r,Advice:s,weave:u,AdviceType:q},i.before=function(a,b,c){return i.weave(a,b,q.BEFORE,c),this},i.after=function(a,b,c){return i.weave(a,b,q.AFTER,c),this},i.around=function(a,b,c){return i.weave(a,b,q.AROUND,c),this},i.exception=function(a,b,c){return i.weave(a,b,q.EXCEPTION,c),this},u(i.Aspect,new r(/^weave$/),i.Aspect.AdviceType.BEFORE,function(a){if(!a.args||a.args.length<3)throw e;if(!i.isObject(a.args[0]))throw e;if(!i.isFunction(a.advice))throw g;a.advice.$crosscutting||(a.advice=new s(a.advice)),a.args[1]instanceof r||(a.args[1]=new r(a.args[1]))}),i.weave=i.Aspect.weave,Object.freeze(i)}(this);