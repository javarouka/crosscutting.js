/*
 crosscutting. AOP JavaScript Library
 author: javarouka@gmail.com
 document: http://javarouka.github.io/crosscutting.js
 license: MIT
 create date: 2014-01-22
*/
!function(a){"function"==typeof define&&define.amd?define(a):"object"==typeof exports?module.exports=a():window.crosscutting=a()}(function(){"use strict";var a=[].slice,b={}.hasOwnProperty,c={}.toString,d=new Error("argument is invalid"),e=new TypeError("cannot apply aop on Built-in Type"),f=new Error("advice function is invalid. It should be function type");Array.prototype.forEach=Array.prototype.forEach||function(a,d){var e,f;if(null==this)throw new TypeError("this is null or not defined");var g=Object(this),h=g.length>>>0;if("[object Function]"!==c.call(a))throw new TypeError(a+" is not a function");for(d&&(e=d),f=0;h>f;){var i;b.call(g,f)&&(i=g[f],a.call(e,i,f,g)),f++}};for(var g={},h=["Function","Number","String","Date","RegExp","Boolean"],i=function(a){g["is"+a]=function(b){return c.call(b)==="[object "+a+"]"}},j=0,k=h.length;k>j;j++)i(h[j]);g.isArray=Array.isArray||function(a){return"[object Array]"===c.call(a)},g.isObject=function(a){return a===Object(a)};var l=[Function.prototype,Number.prototype,String.prototype,Date.prototype,Boolean.prototype,Object.prototype,Date.prototype,Array.prototype],m=function(b){return a.call(b)};g.argumentsToArray=m;var n={BEFORE:function(a){var b=a.advice.call(a.target,a),c=a.todo.apply(a.target,m(a.args));return b||c},AFTER:function(a){var b=a.todo.apply(a.target,m(a.args)),c=a.advice.call(a.target,a);return c||b},AROUND:function(a){return a.advice.call(a.target,function(){return a.todo.apply(a.target,m(arguments[0]?arguments:a.args))},a)},EXCEPTION:function(a){try{return a.todo.apply(a.target,m(a.args))}catch(b){return a.exception=b,a.advice.call(a.target,a)}}},o=function(a){this.matcher=a};o.prototype.isMatch=function(a){if(g.isBoolean(this.matcher))return this.matcher;if(g.isRegExp(this.matcher))return this.matcher.test(a);if(g.isFunction(this.matcher))return this.matcher(a);throw d};var p=function(a){return a.$crosscutting={wrap:!0},a},q=function(a,b,c,d,e){var f=function(){return c({args:arguments,target:a,todo:b,advice:d,type:c,method:e})};return f.name=e,f},r=function(a,b,c,d){return g.isArray(a)||(a=[a]),a.forEach(function(a){l.forEach(function(b){if(b===a)throw e}),g.isString(c)&&(c=n[c.toUpperCase()]);var f;for(var h in a)if(f=h,g.isString(f)){var i=a[f];g.isFunction(i)&&b.isMatch(f)&&(a[f]=q(a,i,c,d,f))}}),this};return g.Aspect={Pointcut:o,Advice:p,weave:r,AdviceType:n},g.before=function(a,b,c){return g.weave(a,b,n.BEFORE,c),this},g.after=function(a,b,c){return g.weave(a,b,n.AFTER,c),this},g.around=function(a,b,c){return g.weave(a,b,n.AROUND,c),this},g.exception=function(a,b,c){return g.weave(a,b,n.EXCEPTION,c),this},r(g.Aspect,new o(/^weave$/),g.Aspect.AdviceType.BEFORE,function(a){if(!a.args||a.args.length<3)throw d;if(!g.isObject(a.args[0]))throw d;if(!g.isFunction(a.advice))throw f;a.advice.$crosscutting||(a.advice=new p(a.advice)),a.args[1]instanceof o||(a.args[1]=new o(a.args[1]))}),g.weave=g.Aspect.weave,Object.freeze&&Object.freeze(g),g});