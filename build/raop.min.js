/*
 raop JavaScript Library
 author: javarouka@gmail.com
 site: http://javarouka.github.io/raop.js
 license: MIT
 create date: 2013-08-18
*/
!function(a){"use strict";var b=[].slice,c=Object.prototype.hasOwnProperty,d=Object.prototype.toString,e=new Error("argument is invalid"),f=new Error("advice function is invalid. It should be function type");Object.freeze=Object.freeze||function(a){return a},Object.keys=Object.keys||function(a){var b=[];for(var d in a)c.call(a,d)&&b.push(d);return b},Object.create=Object.create||function(a){var b=function(){};return b.prototype=a,new b},Array.prototype.forEach=Array.prototype.forEach||function(a,b){var e,f;if(null==this)throw new TypeError("this is null or not defined");var g=Object(this),h=g.length>>>0;if("[object Function]"!==d.call(a))throw new TypeError(a+" is not a function");for(b&&(e=b),f=0;h>f;){var i;c.call(g,f)&&(i=g[f],a.call(e,i,f,g)),f++}};var g=a,h=Object.create(null),i=g.raop;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.raop=h):g.raop=h;for(var j=["Function","Number","String","Date","RegExp"],k=function(a){h["is"+a]=function(b){return d.call(b)==="[object "+a+"]"}},l=0,m=j.length;m>l;l++)k(j[l]);h.isArray=Array.isArray||function(a){return"[object Array]"===d.call(a)},h.isObject=function(a){return a===Object(a)};var n=[Function.prototype,Number.prototype,String.prototype,Date.prototype,Boolean.prototype,Object.prototype,Date.prototype,Array.prototype];h.noConflict=function(){return g.raop=i,this},h.each=function(a,b){if(a.forEach)a.forEach(b);else if(h.isObject(a)){var d;for(d in a)c.call(a,d)&&b.call(a,a[d],d)}else b(a)},h.extend=function(a,b){return h.each(b,function(b,c){a[c]=b}),obj};var o=function(a){return b.call(a)};h.argumentsToArray=o;var p={BEFORE:function(a){var b=a.advice.call(a.target,a),c=a.todo.apply(a.target,o(a.args));return b||c},AFTER:function(a){var b=a.todo.apply(a.target,o(a.args)),c=a.advice.call(a.target,a);return c||b},AROUND:function(a){return a.advice.call(a.target,function(){return a.todo.apply(a.target,o(arguments[0]?arguments:a.args))},a)},EXCEPTION:function(a){try{return a.todo.apply(a.target,o(a.args))}catch(b){return a.exception=b,a.advice.call(a.target,a)}}},q=function(a){this.matcher=a};q.prototype.isMatch=function(a){if(h.isRegExp(this.matcher))return this.matcher.test(a);if(h.isFunction(this.matcher))return this.matcher(a);throw e};var r=function(a){return a.$RAOP={wrap:!0},a},s=function(a,b,c,d,e){var f=function(){return c({args:arguments,target:a,todo:b,advice:d,type:c,method:e})};return f.name=e,f},t=function(a,b,c,d){n.forEach(function(b){if(b===a)throw new TypeError("cannot apply aop on Built-in Type")});var e=Object.keys(a);return h.isString(c)&&(c=p[c.toUpperCase()]),e.forEach(function(e){if(h.isString(e)){var f=a[e];h.isFunction(f)&&b.isMatch(e)&&(a[e]=s(a,f,c,d,e))}}),a};h.Aspect={Pointcut:q,Advice:r,weave:t,AdviceType:p},h.before=function(a,b,c){return h.weave(a,b,p.BEFORE,c)},h.after=function(a,b,c){return h.weave(a,b,p.AFTER,c)},h.around=function(a,b,c){return h.weave(a,b,p.AROUND,c)},h.exception=function(a,b,c){return h.weave(a,b,p.EXCEPTION,c)},t(h.Aspect,new q(/^weave$/),h.Aspect.AdviceType.BEFORE,function(a){if(!a.args||a.args.length<3)throw e;if(!h.isObject(a.args[0]))throw e;if(!h.isFunction(a.advice))throw f;a.advice.$RAOP||(a.advice=new r(a.advice)),a.args[1]instanceof q||(a.args[1]=new q(a.args[1]))}),h.weave=h.Aspect.weave,Object.freeze(h)}(this);